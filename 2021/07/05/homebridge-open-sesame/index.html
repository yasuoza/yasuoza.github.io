<!doctype html><html><head><meta charset=utf-8><base href=https://yasuoza.github.io><title>homebridge-open-sesame</title><link rel=canonical href=https://yasuoza.github.io/2021/07/05/homebridge-open-sesame/><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://yasuoza.github.ioindex.xml title="Back of the flyer"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=stylesheet href=/css/singular.min.f674f27296b832877918f696aa1fe38716960e60a0f6e8be2d645e0ad19ad39b.css integrity="sha256-9nTycpa4Mod5GPaWqh/jhxaWDmCg9ui+LWReCtGa05s=" crossorigin=anonymous media=screen><link href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C400i%2C700%2C700i%2C800%2C800i&subset=latin%2Clatin-ext" rel=stylesheet><link rel=stylesheet href=/css/custom.css media=screen><link rel=stylesheet href=/css/amazon.min.d5af53f3a8ee79e459a775825b59f0dcfbc64cc63c5b69dc71ef303a15d6c8fc.css integrity="sha256-1a9T86jueeRZp3WCW1nw3PvGTMY8W2ncce8wOhXWyPw=" crossorigin=anonymous media=screen></head><body><header id=masthead class=site-header><div class="site-header__branding site-branding"><div class="site-branding__logo site-logo site-logo--rounded"><a class=custom-logo-link rel=home itemprop=url href><img width=96 height=96 src=/images/icon.jpg></a></div><div class=site-branding__copy><h1 class=site-title><a href=/ rel=home>Back of the flyer</a></h1><p class=site-description>Daily life and memos</p></div></div></header><div class="site-main content"><article><header class=entry-header><h1 class=entry-title>homebridge-open-sesame</h1></header><div class="entry-meta entry-meta-before-content"><span class="entry-meta-item posted-on"><a href=https://yasuoza.github.io/2021/07/05/homebridge-open-sesame/><time class="entry-date published" datetime=2021-07-05T13:45:58+0000>July 5, 2021</time></a></span></div><div class=entry-content><figure><img src=https://yasuoza.github.io/2021/07/05/homebridge-open-sesame/homebridge-open-sesame.png></figure><p><a href=https://jp.candyhouse.co/collections/frontpage/products/sesame3>SESAME3</a>と<a href=https://jp.candyhouse.co/collections/frontpage/products/sesame3-bot>SESAME bot</a>をHomeKitに組み込むHomebridgeプラグインを作った。</p><p>主な特徴は次の通り。</p><ul><li>施錠/解錠状態のリアルタイム反映(手動での施錠/解錠を含む)</li><li>プラグインではポーリングを行わないため、APIのレートリミットとなる可能性が低い</li><li>SESAME3に加えてSESAME botも対応</li><li>複数のSESAME3を登録でき、Homeアプリでシーンを設定すれば1タップで複数の鍵を同時に操作できる</li></ul><p>とくにリアルタイムに操作が反映される(そしてHomeアプリに通知を送遅らせることもできる)のはとても重要だ。<br>また、1つのタップで複数のSESAME3を同時に操作するのは現時点では公式のアプリでできないし、Appleのショートカットでも直列にしか操作できないため、かなり使い勝手が悪い。</p><p>このプラグインを実装するに当たって、公式の<a href=https://doc.candyhouse.co/ja/SesameAPI>Web API</a>に加えて、<a href=https://github.com/mochipon/pysesame3>pysesame3</a>というPythonのライブラリを参考にした。<br>とくに、pysesame3は直接AWSのCognitoやAWS IoTと連携する処理を行っているため、その部分のコードを大いに参考にさせていただいた。<br>特徴にあるリアルタイム反映は、SESAME3が接続しているAWS IoTのmqttをこのプラグインでも利用させていただいていることで実現している。</p><p>homebridge-open-sesameのインストールと設定は<a href=https://github.com/oznu/homebridge-config-ui-x>Homebridge Config UI X</a>を利用するとラクだ。<br>プラグインのタブを開いて「<code>Open Sesame</code>」と検索することで簡単にインストールできるし、そのまま設定できる。</p><p>設定に必要なAPIキーやCLIENT_IDは <a href=https://dash.candyhouse.co/>https://dash.candyhouse.co/</a> から取得できる。<br>UUIDやSecret Keyは <a href=https://sesame-qr-reader.vercel.app/>https://sesame-qr-reader.vercel.app/</a> でSESAME3のQRコードを読み込ませることで取得できる。マネージャーかオーナー鍵でないとAPI操作できないので注意。</p><figure><img src=https://yasuoza.github.io/2021/07/05/homebridge-open-sesame/config-ui-x.png></figure><p>あとは取得した内容を先ほどのHomebridge Config UIにて設定すればOK。<br>我が家は鍵が2つあるタイプのドアなので、Homeアプリでシーンを設定して1タップで2つの鍵を同時に操作している。</p><p>一度HomeBridgeで設定してしまえば、あとはiPhoneやiPadのホームアプリでシーンを設定したり、通知の設定をしたりして自由に使うことができる。</p><p>個人的にはかなり便利なので、SESAME3ユーザーかつAppleユーザーの方でHomebridgeを導入できる人はぜひ使ってみて欲しい。<br>そしてフィードバックや要望をお待ちしています。</p></div><nav class="navigation post-navigation" role=navigation aria-label="Posts navigation"><h2 class=screen-reader-text>Posts navigation</h2><div class=nav-links><div class=nav-pre><span>Older Post</span>
<a href=https://yasuoza.github.io/2021/03/08/build_ricty_font_using_docker_container/ rel=prev>Dockerコンテナを利用したRictyフォントのビルド</a></div></div></nav></article></div><footer id=colophon class=site-footer role=contentinfo><div class="site-footer__copy site-copy"></div></footer></body></html>